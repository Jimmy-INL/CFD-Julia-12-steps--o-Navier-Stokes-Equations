<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Welcome to CFD Julia</title>
<!-- 2016-09-26 Mon 12:24 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Zhengrong Cheng" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "left",
        displayIndent: "5em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Welcome to CFD Julia</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Step 1: 1-D Linear Convection</a>
<ul>
<li><a href="#sec-1-1">1.1. Mathematical Model</a></li>
<li><a href="#sec-1-2">1.2. Discretize Equations</a></li>
<li><a href="#sec-1-3">1.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Step 2: 1-D Nonlinear Convection</a>
<ul>
<li><a href="#sec-2-1">2.1. Mathematical Model</a></li>
<li><a href="#sec-2-2">2.2. Discretized Equations</a></li>
<li><a href="#sec-2-3">2.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-3">3. CFL Condition</a></li>
<li><a href="#sec-4">4. Step 3: 1-D Diffusio</a>
<ul>
<li><a href="#sec-4-1">4.1. Mathematical Model</a></li>
<li><a href="#sec-4-2">4.2. Discretized Equations</a></li>
<li><a href="#sec-4-3">4.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Step4: 1-D Burgers' Equation</a>
<ul>
<li><a href="#sec-5-1">5.1. Mathematical Model</a></li>
<li><a href="#sec-5-2">5.2. Discretized Equations</a></li>
<li><a href="#sec-5-3">5.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Array Operations</a></li>
<li><a href="#sec-7">7. Step 5: 2D Linear Convection</a>
<ul>
<li><a href="#sec-7-1">7.1. Mathematical Model</a></li>
<li><a href="#sec-7-2">7.2. Discretized Equations</a></li>
<li><a href="#sec-7-3">7.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-8">8. Step 6: 2D Nonlinear Convection</a>
<ul>
<li><a href="#sec-8-1">8.1. Mathematical Model</a></li>
<li><a href="#sec-8-2">8.2. Discretized Equations</a></li>
<li><a href="#sec-8-3">8.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-9">9. Step 7: 2D Diffusion</a>
<ul>
<li><a href="#sec-9-1">9.1. Mathematical Model</a></li>
<li><a href="#sec-9-2">9.2. Discretized Equations</a></li>
<li><a href="#sec-9-3">9.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-10">10. Step 8: 2D Burgers' Equations</a>
<ul>
<li><a href="#sec-10-1">10.1. Mathematical Model</a></li>
<li><a href="#sec-10-2">10.2. Discretized Equations</a></li>
<li><a href="#sec-10-3">10.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-11">11. Defining Function in Julia</a></li>
<li><a href="#sec-12">12. Step 9: 2D Laplace Equation</a>
<ul>
<li><a href="#sec-12-1">12.1. Mathematical Model</a></li>
<li><a href="#sec-12-2">12.2. Discretized Equations</a></li>
<li><a href="#sec-12-3">12.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-13">13. Step 10: 2D Poisson Equation</a>
<ul>
<li><a href="#sec-13-1">13.1. Mathematical Model</a></li>
<li><a href="#sec-13-2">13.2. Discretized Equations</a></li>
<li><a href="#sec-13-3">13.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-14">14. Step 11: Cavity Flow with Navier-Stokes (last figure is not correct)</a>
<ul>
<li><a href="#sec-14-1">14.1. Mathematical Model</a></li>
<li><a href="#sec-14-2">14.2. Discretized Equations</a></li>
<li><a href="#sec-14-3">14.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-15">15. Step 12: Channel Flow with Navier-Stokes</a>
<ul>
<li><a href="#sec-15-1">15.1. Mathematical Model</a></li>
<li><a href="#sec-15-2">15.2. Discretized equations</a></li>
<li><a href="#sec-15-3">15.3. Julia Codes</a></li>
</ul>
</li>
<li><a href="#sec-16">16. <span class="done DONE">DONE</span> color map</a></li>
</ul>
</div>
</div>
<p>
Hello! Welcome to the <b><b>12 steps to Navier-Stokes</b></b>. This is a practical module that is used in the beginning of an interactive Computational Fluid Dynamics (CFD) course taught by Prof. Lorena Barba between 2009 and 2013 at Boston University (Prof. Barba since moved to the George Washington University). The course assumes only basic programming knowledge (in any language) and of course some foundation in partial differential equations and fluid mechanics. The practical module was inspired by the ideas of Dr. Rio Yokota, who was a post-doc in Prof. Barba's lab, and has been refined by Prof. Barba and her students over several semesters teaching the course. The course is taught entirely using Python and students who don't know Python just learn as we work through the module.
</p>

<p>
This repository aims to transfer the python codes to <a href="https://www.google.ca/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=0ahUKEwivoeaA8aXPAhVH3mMKHUC8BCUQFggcMAA&url=http://julialang.org/&usg=AFQjCNF47iiW0ylaSeEf0dOl27c5kZ22MA&sig2=opOYtHDIuNYVSPcZ7B3ooQ&bvm=bv.133700528,d.cGc">julia</a> as a personal exercise. 
</p>

<p>
Enjoy it!!!
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Step 1: 1-D Linear Convection</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-1-1">
\begin{equation}
\frac{\partial u}{\partial t} + c \frac{\partial u}{\partial x} = 0
\end{equation}

<ul class="org-ul">
<li>Introduce the idea of a grid
</li>
<li>Expand equation using the definition of a derivative
</li>
<li>Discretize into small chunks
</li>
<li>Re-arrange to solve for \(u^{n+1}_i\)
</li>
<li>Initial and boundary conditions
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Discretize Equations</h3>
<div class="outline-text-3" id="text-1-2">
<p>
$$\frac{u_i^{n+1}-u_i^n}{\Delta t} + c \frac{u_i^n - u_{i-1}^n}{\Delta x} = 0 $$
$$u_i^{n+1} = u_i^n - c \frac{\Delta t}{\Delta x}(u_i^n-u_{i-1}^n)$$
</p>
</div>
</div>


<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
nx = 41 ; <span style="color: #99968b;"># </span><span style="color: #99968b;">try changing this number from 41 to 81 and Run All ... what happens?</span>
dx = 2/(nx-1);
nt = 25 ;   <span style="color: #99968b;">#</span><span style="color: #99968b;">nt is the number of timesteps we want to calculate</span>
dt = .025 ; <span style="color: #99968b;">#</span><span style="color: #99968b;">dt is the amount of time each timestep covers (delta t)</span>
c = 1;      <span style="color: #99968b;">#</span><span style="color: #99968b;">assume wavespeed of c = 1</span>
u = ones(nx); <span style="color: #99968b;"># </span><span style="color: #99968b;">function ones()</span>
s=<span style="color: #92a65e; font-weight: bold;">Int</span>(0.5/dx);e=<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dx);
u[s:e]= 2;
print(u)
plot(linspace(0,2,nx), u)
un = ones(nx); <span style="color: #99968b;">#</span><span style="color: #99968b;">initialize a temporary array</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt <span style="color: #99968b;">#</span><span style="color: #99968b;">loop for values of n from 0 to nt, so it will run nt times</span>
    un = copy(u) <span style="color: #99968b;">##</span><span style="color: #99968b;">copy the existing values of u into un</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> 2:nx <span style="color: #99968b;">## </span><span style="color: #99968b;">you can try commenting this line and...</span>
        u[i] = un[i]-c*dt/dx*(un[i]-un[i-1]);
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
<span style="color: #8ac6f2; font-weight: bold;">end</span>

figure()
plot(linspace(0,2,nx),u);
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Step 2: 1-D Nonlinear Convection</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-2-1">
\begin{equation}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} = 0
\end{equation}


<ul class="org-ul">
<li>Introduce non-linear PDE equation
</li>
<li>Expand equation using definition of derivative
</li>
<li>Discretize
</li>
<li>Solve for \(u^{n+1}_i\)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-2-2">
<p>
$$\frac{u_i^{n+1}-u_i^n}{\Delta t} + u_i^n \frac{u_i^n-u_{i-1}^n}{\Delta x} = 0$$
</p>

<p>
$$u_i^{n+1} = u_i^n - u_i^n \frac{\Delta t}{\Delta x} (u_i^n - u_{i-1}^n)$$
</p>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
nx = 41 ; <span style="color: #99968b;"># </span><span style="color: #99968b;">try changing this number from 41 to 81 and Run All ... what happens?</span>
dx = 2/(nx-1);
nt = 25 ;   <span style="color: #99968b;">#</span><span style="color: #99968b;">nt is the number of timesteps we want to calculate</span>
dt = .025 ; <span style="color: #99968b;">#</span><span style="color: #99968b;">dt is the amount of time each timestep covers (delta t)</span>
c = 1;      <span style="color: #99968b;">#</span><span style="color: #99968b;">assume wavespeed of c = 1</span>
u = ones(nx);    <span style="color: #99968b;"># </span><span style="color: #99968b;">function ones()</span>
s=<span style="color: #92a65e; font-weight: bold;">Int</span>(0.5/dx);e=<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dx);
u[s:e]= 2;
un = ones(nx); <span style="color: #99968b;">#</span><span style="color: #99968b;">initialize a temporary array</span>

<span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt <span style="color: #99968b;">#</span><span style="color: #99968b;">loop for values of n from 0 to nt, so it will run nt times</span>
    un = copy(u) <span style="color: #99968b;">##</span><span style="color: #99968b;">copy the existing values of u into un</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> 2:nx <span style="color: #99968b;">## </span><span style="color: #99968b;">you can try commenting this line and...</span>
        u[i] = un[i]-un[i]*dt/dx*(un[i]-un[i-1]);
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
<span style="color: #8ac6f2; font-weight: bold;">end</span>
plot(linspace(0,2,nx),u);
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> CFL Condition</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>The Courant number
</li>
<li>Explanation of blow-up behavior when wave travels a distance \(> dx\) during a time \(dt\)
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Step 3: 1-D Diffusio</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-4-1">
\begin{equation}
\frac{\partial u}{\partial t} = \nu \frac{\partial ^2 u}{\partial x^2}
\end{equation}

<ul class="org-ul">
<li>Introduce diffusion equation
</li>
<li>Discretize 2nd order derivative using Taylor series expansion
</li>
<li>Discretize time derivative using def. of derivative
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-4-2">
<p>
\(u_{i+1} = u_i + \Delta x \frac{\partial u}{\partial x}\bigg|_i + \frac{\Delta x^2}{2} \frac{\partial ^2 u}{\partial x^2}\bigg|_i + \frac{\Delta x^3}{3} \frac{\partial ^3 u}{\partial x^3}\bigg|_i + O(\Delta x^4)\)
</p>

<p>
\(u_{i-1} = u_i - \Delta x \frac{\partial u}{\partial x}\bigg|_i + \frac{\Delta x^2}{2} \frac{\partial ^2 u}{\partial x^2}\bigg|_i - \frac{\Delta x^3}{3} \frac{\partial ^3 u}{\partial x^3}\bigg|_i + O(\Delta x^4)\)
$$\frac{\partial ^2 u}{\partial x^2}=\frac{u_{i+1}-2u_{i}+u_{i-1}}{\Delta x^2} + O(\Delta x^2)$$
$$\frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}=\nu\frac{u_{i+1}^{n}-2u_{i}^{n}+u_{i-1}^{n}}{\Delta x^2}$$
</p>


<p>
$$u_{i}^{n+1}=u_{i}^{n}+\frac{\nu\Delta t}{\Delta x^2}(u_{i+1}^{n}-2u_{i}^{n}+u_{i-1}^{n})$$
</p>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-julia">   <span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">diffusion_1d</span>(nx)
    <span style="color: #99968b;">#</span><span style="color: #99968b;">nx = 41 ; # try changing this number from 41 to 81 and Run All ... what happens?</span>
    dx = 2/(nx-1);
    nt = 20 ;   <span style="color: #99968b;">#</span><span style="color: #99968b;">nt is the number of timesteps we want to calculate</span>
    nu = 0.3   <span style="color: #99968b;">#</span><span style="color: #99968b;">the value of viscosity</span>
    sigma = .2 <span style="color: #99968b;">#</span><span style="color: #99968b;">sigma is a parameter, we'll learn more about it later</span>
    dt = (sigma*(dx^2))/nu ; <span style="color: #99968b;">#</span><span style="color: #99968b;">dt is the amount of time each timestep covers (delta t)</span>


    u = ones(nx);    <span style="color: #99968b;"># </span><span style="color: #99968b;">function ones()</span>
    s=<span style="color: #92a65e; font-weight: bold;">Int</span>(0.5/dx);e=<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dx);
    u[s:e]= 2;
    <span style="color: #99968b;">#</span><span style="color: #99968b;">plot(linspace(0,2,nx),u);    </span>
    un = ones(nx); <span style="color: #99968b;">#</span><span style="color: #99968b;">initialize a temporary array</span>
    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt <span style="color: #99968b;">#</span><span style="color: #99968b;">loop for values of n from 0 to nt, so it will run nt times</span>
        un = copy(u) <span style="color: #99968b;">##</span><span style="color: #99968b;">copy the existing values of u into un</span>
        <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> 2:nx-1 <span style="color: #99968b;">## </span><span style="color: #99968b;">you can try commenting this line and...</span>
            u[i] = un[i]+nu*dt/dx^2*(un[i+1]-2*un[i]+un[i-1]);
                <span style="color: #99968b;">#</span><span style="color: #99968b;">plot(linspace(0,2,nx),u);    </span>

        <span style="color: #8ac6f2; font-weight: bold;">end</span>
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    plot(linspace(0,2,nx),u);    
<span style="color: #8ac6f2; font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Step4: 1-D Burgers' Equation</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-5-1">
\begin{equation}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} = \nu \frac{\partial ^2 u}{\partial x^2}
\end{equation}

<ul class="org-ul">
<li>Introduce Burgers' Equation
</li>
<li>Note that it is combination of diffusion and non-linear convection
</li>
<li>Introduce different I.C. and B.C. for periodic behavior
<ul class="org-ul">
<li>e.g. What does \(u^{n}_{i+1}\) \textit{mean} at the end of the frame?
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-5-2">
<p>
$$\frac{u_i^{n+1}-u_i^n}{\Delta t} + u_i^n \frac{u_i^n - u_{i-1}^n}{\Delta x} = \nu \frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\Delta x^2}$$
</p>


<p>
$$u_i^{n+1} = u_i^n - u_i^n \frac{\Delta t}{\Delta x} (u_i^n - u_{i-1}^n) + \nu \frac{\Delta t}{\Delta x^2}(u_{i+1}^n - 2u_i^n + u_{i-1}^n)$$
</p>


<p>
Our initial condition for this problem is going to be:
</p>

\begin{eqnarray}
u &=& -\frac{2 \nu}{\phi} \frac{\partial \phi}{\partial x} + 4 \\\
\phi &=& \exp \bigg(\frac{-x^2}{4 \nu} \bigg) + \exp \bigg(\frac{-(x-2 \pi)^2}{4 \nu} \bigg)
\end{eqnarray}

<p>
This has an analytical solution, given by:
</p>

\begin{eqnarray}
u &=& -\frac{2 \nu}{\phi} \frac{\partial \phi}{\partial x} + 4 \\\
\phi &=& \exp \bigg(\frac{-(x-4t)^2}{4 \nu (t+1)} \bigg) + \exp \bigg(\frac{-(x-4t -2 \pi)^2}{4 \nu(t+1)} \bigg)
\end{eqnarray}

<p>
Our boundary condition will be:
</p>

<p>
$$u(0) = u(2\pi)$$
</p>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> SymPy
Sympy.init_printing(use_latex=True)
t = Sym(<span style="color: #95e454;">"t"</span>);
x, nu= symbols(<span style="color: #95e454;">"x,nu"</span>, real=<span style="color: #e5786d;">true</span>);
phi = exp(-(x-4*t)^2/(4*nu*(t+1))) + exp(-(x-4*t-2*pi)^2/(4*nu*(t+1)))
phiprime = diff(phi,x)
print(phiprime)

u = -2*nu*(phiprime/phi)+4
print(u)

ufunc = lambdify(u,(t, x, nu))
print(ufunc(1,4,3))

<span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
nx = 101 ; <span style="color: #99968b;"># </span><span style="color: #99968b;">try changing this number from 41 to 81 and Run All ... what happens?</span>
dx = 2*pi/(nx-1);
nt = 100 ;   <span style="color: #99968b;">#</span><span style="color: #99968b;">nt is the number of timesteps we want to calculate</span>
nu = 0.07;   <span style="color: #99968b;">#</span><span style="color: #99968b;">the value of viscosity</span>
dt = dx*nu; <span style="color: #99968b;">#</span><span style="color: #99968b;">dt is the amount of time each timestep covers (delta t)</span>
x=linspace(0,2*pi, nx)
un = zeros(nx)
t = 0
u = [ufunc(t,x0,nu) <span style="color: #8ac6f2; font-weight: bold;">for</span> x0 <span style="color: #8ac6f2; font-weight: bold;">in</span> x]

figure(figsize=(11,7),dpi=100)
plot(x,u,marker=<span style="color: #95e454;">"o"</span>,lw=2)
xlim(0,2pi)
ylim(0,10)

<span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt   <span style="color: #99968b;"># </span><span style="color: #99968b;">time steps</span>
    un = copy(u);
    <span style="color: #8ac6f2; font-weight: bold;">for</span> i <span style="color: #8ac6f2; font-weight: bold;">in</span> 2:nx-1
        u[i] = un[i] - un[i] * dt/dx *(un[i] - un[i-1]) + nu*dt/dx^2*(un[i+1]-2*un[i]+un[i-1]);
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    u[1] = un[1] - un[1] * dt/dx * (un[1] - un[<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]) + nu*dt/dx^2*(un[2]-2*un[1]+un[<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]);
    u[<span style="color: #8ac6f2; font-weight: bold;">end</span>] = un[<span style="color: #8ac6f2; font-weight: bold;">end</span>] - un[<span style="color: #8ac6f2; font-weight: bold;">end</span>] * dt/dx * (un[<span style="color: #8ac6f2; font-weight: bold;">end</span>] - un[<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]) + nu*dt/dx^2*(un[1]-2*un[<span style="color: #8ac6f2; font-weight: bold;">end</span>]+un[<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]);
<span style="color: #8ac6f2; font-weight: bold;">end</span>


u_analytical = [ufunc(nt*dt, xi, nu) <span style="color: #8ac6f2; font-weight: bold;">for</span> xi <span style="color: #8ac6f2; font-weight: bold;">in</span> x];
figure(figsize=(11,7), dpi=100)
plot(x,u, marker=<span style="color: #95e454;">"o"</span>, lw=2, label=<span style="color: #95e454;">"Computational"</span>)
plot(x, u_analytical, label=<span style="color: #95e454;">"Analytical"</span>)
xlim(0,2*pi)
ylim([0,10])
legend();
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Array Operations</h2>
<div class="outline-text-2" id="text-6">
<p>
Another brief interlude to introduce handling calculations with array operations instead of iterating over the entire array.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Step 5: 2D Linear Convection</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-7-1">
\begin{equation}
\frac{\partial u}{\partial t} + c (\frac{\partial u}{\partial x} + \frac{\partial u}{\partial y}) = 0
\end{equation}

<ul class="org-ul">
<li>Introduction to 2D grid
</li>
<li>Extension of current discretization rules into \(i,j\) flatland
</li>
<li>Discretize 2D equation and solve for unknown
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-7-2">
<p>
$$\frac{u_{i,j}^{n+1}-u_{i,j}^n}{\Delta t} + c\frac{u_{i, j}^n-u_{i-1,j}^n}{\Delta x} + c\frac{u_{i,j}^n-u_{i,j-1}^n}{\Delta y}=0$$
</p>

<p>
As before, solve for the only unknown:
</p>

<p>
$$u_{i,j}^{n+1} = u_{i,j}^n-c \frac{\Delta t}{\Delta x}(u_{i,j}^n-u_{i-1,j}^n)-c \frac{\Delta t}{\Delta y}(u_{i,j}^n-u_{i,j-1}^n)$$
</p>

<p>
We will solve this equation with the following initial conditions:
</p>

<p>
$$u(x) = \begin{cases}
</p>
<p>
\begin{matrix}
2\ \text{for} &amp; 0.5 &le; x &le; 1 \cr
1\ \text{for} &amp; \text{everywhere else}\end{matrix}\end{cases}$$
</p>

<p>
and boundary conditions:
</p>

<p>
$$u = 1\ \text{for } \begin{cases}
</p>
<p>
\begin{matrix}
x =  0,\ 2 \cr
y =  0,\ 2 \end{matrix}\end{cases}$$
</p>
</div>
</div>
<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-7-3">
<pre class="example">
using PyPlot
###variable declarations
nx = 81
ny = 81
nt = 100
c = 1
dx = 2/(nx-1)
dy = 2/(ny-1)
sigma = .2
dt = sigma*dx

x = linspace(0,2,nx)
y = linspace(0,2,ny)

u = ones(ny,nx) ##create a 1xn vector of 1's
un = ones(ny,nx) ##

###Assign initial conditions

u[Int(.5/dy):Int(1/dy),Int(.5/dx):Int(1/dx)]=2 ##set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2

###Plot Initial Condition
fig = figure(figsize=(11,7), dpi=100)          ##the figsize parameter can be used to produce different sized images
#ax = fig.gca(projection="3d")                      
s =surf(x,y,u)

u = ones((ny,nx))
u[Int(.5/dy):Int(1/dy)+1,Int(.5/dx):Int(1/dx+1)]=2 ##set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2

for n in 0:nt ##loop across number of time steps
    un = copy(u)
    row, col = size(u)
    for j in 2:row-1
        for i in 2:col-1
            u[j,i] = un[j, i] - (c*dt/dx*(un[j,i] - un[j,i-1]))-(c*dt/dy*(un[j,i]-un[j-1,i]))
            u[1,:] = 1
            u[end,:] = 1
            u[:,1] = 1
            u[:,end] = 1
        end
    end
end

fig = figure(figsize=(11,7), dpi=100)
s = surf(x,y, u)

u = ones((ny,nx))
u[Int(.5/dy):Int(1/dy)+1,Int(.5/dx):Int(1/dx+1)]=2 ##set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2

for n in 1:nt ##loop across number of time steps
    un = copy(u)
    u[2:end,2:end]=un[2:end,2:end]-(c*dt/dx*(un[2:end,2:end]-un[2:end,1:end-1]))-(c*dt/dy*(un[2:end,2:end]-un[1:end-1,2:end]))
    u[1,:] = 1
    u[end,:] = 1
    u[:,1] = 1
    u[:,end] = 1
end

fig = figure(figsize=(11,7), dpi=100)
s = surf(x,y, u)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Step 6: 2D Nonlinear Convection</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-8-1">
\begin{equation}
\label{eq:1}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} + v \frac{\partial u}{\partial y} = 0
\end{equation}
\begin{equation}
\label{eq:2}
\frac{\partial v}{\partial t} + u \frac{\partial v}{\partial x} + v \frac{\partial v}{\partial y} = 0
\end{equation}

<ul class="org-ul">
<li>Introduction of coupled PDEs
</li>
<li>Discretization of two equations
</li>
<li>Solving for both \(u^{n+1}_{i,j}\) and \(v^{n+1}_{i,j}\)
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-8-2">
<p>
$$\frac{u_{i,j}^{n+1}-u_{i,j}^n}{\Delta t} + u_{i,j}^n \frac{u_{i,j}^n-u_{i-1,j}^n}{\Delta x} + v_{i,j}^n \frac{u_{i,j}^n-u_{i,j-1}^n}{\Delta y} = 0$$
</p>

<p>
$$\frac{v_{i,j}^{n+1}-v_{i,j}^n}{\Delta t} + u_{i,j}^n \frac{v_{i,j}^n-v_{i-1,j}^n}{\Delta x} + v_{i,j}^n \frac{v_{i,j}^n-v_{i,j-1}^n}{\Delta y} = 0$$
Rearranging both equations, we solve for \(u_{i,j}^{n+1}\) and \(v_{i,j}^{n+1}\), respectively.  Note that these equations are also coupled.  
</p>

<p>
$$u_{i,j}^{n+1} = u_{i,j}^n - u_{i,j} \frac{\Delta t}{\Delta x} (u_{i,j}^n-u_{i-1,j}^n) - v_{i,j}^n \frac{\Delta t}{\Delta y} (u_{i,j}^n-u_{i,j-1}^n)$$
</p>

<p>
$$v_{i,j}^{n+1} = v_{i,j}^n - u_{i,j} \frac{\Delta t}{\Delta x} (v_{i,j}^n-v_{i-1,j}^n) - v_{i,j}^n \frac{\Delta t}{\Delta y} (v_{i,j}^n-v_{i,j-1}^n)$$
The initial conditions are the same that we used for 1D convection, applied in both the x and y directions.  
</p>

<p>
$$u,\ v\ = \begin{cases}\begin{matrix}
2 & \text{for } x,y \in (0.5, 1)\times(0.5,1) \cr
1 & \text{everywhere else}
\end{matrix}\end{cases}$$
</p>

<p>
The boundary conditions hold u and v equal to 1 along the boundaries of the grid
.
</p>

<p>
$$u = 1,\ v = 1 \text{ for } \begin{cases} \begin{matrix}x=0,2\cr y=0,2 \end{matrix}\end{cases}$$
</p>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot

<span style="color: #99968b;">###</span><span style="color: #99968b;">variable declarations</span>
nx = 101;
ny = 101;
nt = 80;
c = 1;
dx = 2/(nx-1);
dy = 2/(ny-1);
sigma = 0.2;
dt = sigma*dx;

x = linspace(0,2,nx);
y = linspace(0,2,ny);

u = ones(ny,nx) ;<span style="color: #99968b;">##</span><span style="color: #99968b;">create a 1xn vector of 1's</span>
v = ones(ny,nx);
un = ones(ny,nx);
vn = ones(ny,nx);

<span style="color: #99968b;">###</span><span style="color: #99968b;">Assign initial conditions</span>
s=<span style="color: #92a65e; font-weight: bold;">Int</span>(.5/dy);
e=<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dy);
u[s:e,s:e]=2 <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>
v[s:e,s:e]=2 <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>
fig = figure(figsize=(11,7), dpi=100)          <span style="color: #99968b;">##</span><span style="color: #99968b;">the figsize parameter can be used to produce different sized images</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax = fig.gca(projection="3d")                      </span>
ss =surf(x,y,u,cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))
figure()
ss2=surf(x,y,v)

ss3=surf(x,y,u)

<span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt <span style="color: #99968b;">##</span><span style="color: #99968b;">loop across number of time steps</span>
    un = copy(u)
    vn = copy(v)


    u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]=un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>].*(c*dt/dx*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])))-(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>].*(c*dt/dy*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>])))
    v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]=vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>].*(c*dt/dx*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])))-(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>].*(c*dt/dy*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>])))

    <span style="color: #99968b;">#</span><span style="color: #99968b;">u[2:end,2:end]=un[2:end,2:end]-(un[2:end,2:end]*c*dt/dx*(un[2:end,2:end]-un[2:end,1:end-1]))-(vn[2:end,2:end]*c*dt/dy*(un[2:end,2:end]-un[1:end-1,2:end]))</span>
    <span style="color: #99968b;">#</span><span style="color: #99968b;">v[2:end,2:end]=vn[2:end,2:end]-(un[2:end,2:end]*c*dt/dx*(vn[2:end,2:end]-vn[2:end,1:end-1]))-(vn[2:end,2:end]*c*dt/dy*(vn[2:end,2:end]-vn[1:end-1,2:end]))</span>

    u[1,:] = 1;
    u[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 1;
    u[:,1] = 1;
    u[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 1;

    v[1,:] = 1;
    v[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 1;
    v[:,1] = 1;
    v[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 1;
    <span style="color: #99968b;">#</span><span style="color: #99968b;">fig = figure(figsize=(11,7), dpi=100)          ##the figsize parameter can be used to produce different sized images</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax = fig.gca(projection="3d")                      </span>
   <span style="color: #99968b;"># </span><span style="color: #99968b;">ss =surf(x,y,u)</span>
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #99968b;">###</span><span style="color: #99968b;">Plot Initial Condition</span>
fig = figure(figsize=(11,7), dpi=100)          <span style="color: #99968b;">##</span><span style="color: #99968b;">the figsize parameter can be used to produce different sized images</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax = fig.gca(projection="3d")                      </span>
s =surf(x,y,u,cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))

<span style="color: #99968b;">###</span><span style="color: #99968b;">Plot Initial Condition</span>
fig = figure(figsize=(11,7), dpi=100)          <span style="color: #99968b;">##</span><span style="color: #99968b;">the figsize parameter can be used to produce different sized images</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax = fig.gca(projection="3d")   </span>
ax=axes()
xgrid=repmat(x',nx,1)
ygrid=repmat(y,1,nx)
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax[:plot_surface](xgrid, ygrid,v,cmap=ColorMap("gray"))</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">s =surf(x,y,v,)</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">s =surf(x,y,v,)</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">get_cmap("bwr")</span>
ss5=surf(xgrid,ygrid,v,cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Step 7: 2D Diffusion</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-9-1">
\begin{equation}
\label{eq:3}
\frac{\partial u}{\partial t} = \nu \frac{\partial ^2 u}{\partial x^2} + \nu \frac{\partial ^2 u}{\partial y^2}
\end{equation}
</div>
</div>
<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-9-2">
\begin{equation}
\label{eq:4}
u_{i,j}^{n+1} = u_{i,j}^n + \frac{\nu \Delta t}{\Delta x^2}(u_{i+1,j}^n - 2 u_{i,j}^n + u_{i-1,j}^n) + \frac{\nu \Delta t}{\Delta y^2}(u_{i,j+1}^n-2 u_{i,j}^n + u_{i,j-1}^n)
\end{equation}
<ul class="org-ul">
<li>Introduction to 2D diffusion equation
</li>
<li>Discretization of equation, etc&#x2026;
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
plt=PyPlot

<span style="color: #99968b;">###</span><span style="color: #99968b;">variable declarations</span>
nx = 101;
ny = 101;
<span style="color: #99968b;">#</span><span style="color: #99968b;">nt = 17;</span>
nu=.2;
dx = 2/(nx-1);
dy = 2/(ny-1);
sigma = .25;
dt = sigma*dx*dy/nu;

x = linspace(0,2,nx);
y = linspace(0,2,ny);

u = ones(ny,nx); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a 1xn vector of 1's</span>
un = ones(ny,nx); 
dx,dy
0.5/dx, 1/dy

<span style="color: #99968b;">###</span><span style="color: #99968b;">Assign initial conditions</span>
s=<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(0.5/dy));
e=<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(1.0/dy));
u[s:e,s:e]=2; <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">u[Int(.5/dy):Int(1/dy),Int(0.5/dx):Int(1/dx)]=2 ##set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>

fig1 = figure()
<span style="color: #99968b;">#</span><span style="color: #99968b;">ax = fig.gca(projection='3d')</span>
<span style="color: #99968b;">#</span><span style="color: #99968b;">surf = ax.plot_surface(X,Y,u, rstride=1, cstride=1, cmap=cm.coolwarm,</span>
 <span style="color: #99968b;">#       </span><span style="color: #99968b;">linewidth=0, antialiased=False)</span>
ss = surf(x,y,u)
xlim(0,2)
ylim(0,2)
zlim(1,2.5);

<span style="color: #99968b;">###</span><span style="color: #99968b;">Run through nt timesteps</span>
<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">diffuse</span>(nt)
    <span style="color: #99968b;">###</span><span style="color: #99968b;">Assign initial conditions</span>
    s=<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(0.5/dy));
    e=<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(1.0/dy));
    u[s:e,s:e]=2; <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>
    <span style="color: #99968b;">#</span><span style="color: #99968b;">u[Int(.5/dy):Int(1/dy),Int(0.5/dx):Int(1/dx)]=2 ##set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>


    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt 
        un = copy(u) ;
        u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]=un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+nu*dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+nu*dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])
        u[1,:]=1
        u[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:]=1
        u[:,1]=1
        u[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>]=1
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    xgrid = repmat(x', nx, 1 )
    ygrid = repmat(y, 1, ny )
    fig1 = figure()
    ax=plt.gca()
    <span style="color: #99968b;">#</span><span style="color: #99968b;">ss = surf(x,y,u,cmap=ColorMap("coolwarm"))</span>
    plt.plot_surface(xgrid,ygrid,u,cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))
    xlim(0,2)
    ylim(0,2)
    zlim(1,2.5);
<span style="color: #8ac6f2; font-weight: bold;">end</span>

diffuse(10)
diffuse(100)
diffuse(500)
diffuse(1000)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Step 8: 2D Burgers' Equations</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-10-1">
\begin{equation}
\label{eq:5}
\frac{\partial u}{\partial t} + u \frac{\partial u}{\partial x} + v \frac{\partial u}{\partial y} = \nu \; \left(\frac{\partial ^2 u}{\partial x^2} + \frac{\partial ^2 u}{\partial y^2}\right)
\end{equation}

\begin{equation}
\label{eq:6}
\frac{\partial v}{\partial t} + u \frac{\partial v}{\partial x} + v \frac{\partial v}{\partial y} = \nu \; \left(\frac{\partial ^2 v}{\partial x^2} + \frac{\partial ^2 v}{\partial y^2}\right)
\end{equation}
</div>
</div>

<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-10-2">
\begin{equation}
\label{eq:7}
u_{i,j}^{n+1} = u_{i,j}^n - \frac{\Delta t}{\Delta x} u_{i,j}^n (u_{i,j}^n - u_{i-1,j}^n) - \frac{\Delta t}{\Delta y} v_{i,j}^n (u_{i,j}^n - u_{i,j-1}^n)+\frac{\nu \Delta t}{\Delta x^2}(u_{i+1,j}^n-2u_{i,j}^n+u_{i-1,j}^n) + \frac{\nu \Delta t}{\Delta y^2} (u_{i,j+1}^n - 2u_{i,j}^n + u_{i,j+1}^n)
\end{equation}

\begin{equation}
\label{eq:8}
v_{i,j}^{n+1} =  v_{i,j}^n - \frac{\Delta t}{\Delta x} u_{i,j}^n (v_{i,j}^n - v_{i-1,j}^n) - \frac{\Delta t}{\Delta y} v_{i,j}^n (v_{i,j}^n - v_{i,j-1}^n)+\frac{\nu \Delta t}{\Delta x^2}(v_{i+1,j}^n-2v_{i,j}^n+v_{i-1,j}^n) + \frac{\nu \Delta t}{\Delta y^2} (v_{i,j+1}^n - 2v_{i,j}^n + v_{i,j+1}^n)
\end{equation}


\begin{equation}
\label{eq:11}

\end{equation}
</div>
</div>
<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-10-3">
<p>
Here comes Julia codes for this problem.
</p>
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
plt=PyPlot

<span style="color: #99968b;">###</span><span style="color: #99968b;">variable declarations</span>
nx = 41;
ny = 41;
nt = 120;
c = 1;
dx = 2/(nx-1);
dy = 2/(ny-1);
sigma = .0009;
nu = 0.01;
dt = sigma*dx*dy/nu;


x = linspace(0,2,nx);
y = linspace(0,2,ny);

u = ones((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a 1xn vector of 1's</span>
v = ones((ny,nx));
un = ones((ny,nx)); <span style="color: #99968b;">##</span>
vn = ones((ny,nx));
comb = ones((ny,nx))

<span style="color: #99968b;">###</span><span style="color: #99968b;">Assign initial conditions</span>

u[<span style="color: #92a65e; font-weight: bold;">Int</span>(.5/dy):<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dy),<span style="color: #92a65e; font-weight: bold;">Int</span>(.5/dx):<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dx)]=2 <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>
v[<span style="color: #92a65e; font-weight: bold;">Int</span>(.5/dy):<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dy),<span style="color: #92a65e; font-weight: bold;">Int</span>(.5/dx):<span style="color: #92a65e; font-weight: bold;">Int</span>(1/dx)]=2 <span style="color: #99968b;">##</span><span style="color: #99968b;">set hat function I.C. : u(.5&lt;=x&lt;=1 &amp;&amp; .5&lt;=y&lt;=1 ) is 2</span>

<span style="color: #99968b;">###</span><span style="color: #99968b;">(plot ICs)</span>
fig0 = plt.figure(figsize=(11,7), dpi=100)

wire1 = plt.plot_wireframe(x,y,u, cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))
wire2 = plt.plot_wireframe(x,y,v, cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>))

<span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt <span style="color: #99968b;">##</span><span style="color: #99968b;">loop across number of time steps</span>
    un = copy(u)
    vn = copy(v)

    u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] - dt/dx*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
dt/dy*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
nu*dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
nu*dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])

    v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] - dt/dx*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
dt/dy*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
nu*dt/dx^2*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
nu*dt/dy^2*(vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])

    u[1,:] = 1
    u[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 1
    u[:,1] = 1
    u[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 1

    v[1,:] = 1
    v[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 1
    v[:,1] = 1
    v[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 1
<span style="color: #8ac6f2; font-weight: bold;">end</span>

fig = plt.figure(figsize=(11,7), dpi=100)
wire1 = plt.plot_wireframe(x,y,u,color=<span style="color: #95e454;">"b"</span>)
fig2=plt.figure(figsize=(11,7),dpi=100)
wire2 = plt.plot_wireframe(x,y,v,color=<span style="color: #95e454;">"k"</span>)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Defining Function in Julia</h2>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Step 9: 2D Laplace Equation</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-12-1">
\begin{equation}
\label{eq:12}
\frac{\partial ^2 p}{\partial x^2} + \frac{\partial ^2 p}{\partial y^2} = 0
\end{equation}
</div>
</div>
<div id="outline-container-sec-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-12-2">
\begin{equation}
\label{eq:13}
\frac{p_{i+1, j}^n - 2p_{i,j}^n + p_{i-1,j}^n}{\Delta x^2} + \frac{p_{i,j+1}^n - 2p_{i,j}^n + p_{i, j-1}^n}{\Delta y^2} = 0
\end{equation}

\begin{equation}
\label{eq:14}
p_{i,j}^n = \frac{\Delta y^2(p_{i+1,j}^n+p_{i-1,j}^n)+\Delta x^2(p_{i,j+1}^n + p_{i,j-1}^n)}{2(\Delta x^2 + \Delta y^2)}

\end{equation}


<p>
boundary conditions are:
</p>

<p>
\(p=0\) at \(x=0\)
</p>

<p>
\(p=y\) at \(x=2\)
</p>

<p>
\(\frac{\partial p}{\partial y}=0\) at \(y=0, \ 1\)
</p>
</div>
</div>
<div id="outline-container-sec-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-12-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
plt=PyPlot

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">plot2D</span>(x, y, p)
    fig = plt.figure(figsize=(11,7), dpi=100)
    ss = plt.plot_surface(x,y,p, rstride=1, cstride=1, cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>),
            linewidth=0)
    xlim(0,2)
    ylim(0,1)
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">laplace2d</span>(p, y, dx, dy, l1norm_target)
    l1norm = 1;
    pn = zeros(size(p));
    tol=10000;
    count=1;
    <span style="color: #8ac6f2; font-weight: bold;">while</span> (l1norm &gt; l1norm_target || count &gt; tol)
        pn = copy(p);
        p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = (dy^2*(pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]+pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+dx^2*(pn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+pn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]))/(2*(dx^2+dy^2)) 

        p[:,1] = 0;       <span style="color: #99968b;">##</span><span style="color: #99968b;">p = 0 @ x = 0</span>
        p[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = y;      <span style="color: #99968b;">##</span><span style="color: #99968b;">p = y @ x = 2</span>
        p[1,:] = p[1,:]  <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 @ y = 0</span>
        p[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = p[<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,:]    <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 @ y = 1</span>
        l1norm = norm((p-pn)./pn,1)
        count +=1;
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    p
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #99968b;">##</span><span style="color: #99968b;">variable declarations</span>
nx = 31;
ny = 31;
c = 1;
dx = 2/(nx-1);
dy = 2/(ny-1);


<span style="color: #99968b;">##</span><span style="color: #99968b;">initial conditions</span>
p = zeros((ny,nx)) ;<span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>


<span style="color: #99968b;">##</span><span style="color: #99968b;">plotting aids</span>
x = linspace(0,2,nx);
y = linspace(0,1,ny);

<span style="color: #99968b;">##</span><span style="color: #99968b;">boundary conditions</span>
p[:,1] = 0;     <span style="color: #99968b;">##</span><span style="color: #99968b;">p = 0 @ x = 0</span>
p[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = y;    <span style="color: #99968b;">##</span><span style="color: #99968b;">p = y @ x = 2</span>
p[1,:] = p[2,:];    <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 @ y = 0</span>
<span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 @ y = 1</span>
p[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = p[<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,:];
plot2D(x, y, p)

p = laplace2d(p, y, dx, dy, 1e-4);
fig2=plt.figure()
plot2D(x, y, p)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> Step 10: 2D Poisson Equation</h2>
<div class="outline-text-2" id="text-13">
</div><div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-13-1">
\begin{equation}
\label{eq:15}
\frac{\partial ^2 p}{\partial x^2} + \frac{\partial ^2 p}{\partial y^2} = b
\end{equation}
</div>
</div>
<div id="outline-container-sec-13-2" class="outline-3">
<h3 id="sec-13-2"><span class="section-number-3">13.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-13-2">
\begin{equation}
\label{eq:16}
\frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2}+\frac{p_{i,j+1}^{n}-2 p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2}=b_{i,j}^{n}
\end{equation}

\begin{equation}
\label{eq:17}
p_{i,j}^{n}=\frac{(p_{i+1,j}^{n}+p_{i-1,j}^{n})\Delta y^2+(p_{i,j+1}^{n}+p_{i,j-1}^{n})\Delta x^2-b_{i,j}^{n}\Delta x^2\Delta y^2}{2(\Delta x^2+\Delta y^2)}
\end{equation}

<p>
Boundary conditions:
\(p=0\) at \(x=0, \ 2\) and \(y=0, \ 1\)
</p>

<p>
\(b_{i,j}=100\) at \(i=nx/4, j=ny/4\)
</p>

<p>
\(b_{i,j}=-100\) at \(i=nx*3/4, j=3/4 ny\)
</p>

<p>
\(b_{i,j}=0\) everywhere else.
</p>
</div>
</div>
<div id="outline-container-sec-13-3" class="outline-3">
<h3 id="sec-13-3"><span class="section-number-3">13.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
plt=PyPlot

<span style="color: #99968b;"># </span><span style="color: #99968b;">Parameters</span>
nx = 50;
ny = 50;
nt  = 100;
xmin = 0;
xmax = 2;
ymin = 0;
ymax = 1;

dx = (xmax-xmin)/(nx-1);
dy = (ymax-ymin)/(ny-1);

<span style="color: #99968b;"># </span><span style="color: #99968b;">Initialization</span>
p  = zeros((ny,nx));
pd = zeros((ny,nx));
b  = zeros((ny,nx));
x  = linspace(xmin,xmax,nx);
y  = linspace(xmin,xmax,ny);

<span style="color: #99968b;"># </span><span style="color: #99968b;">Source</span>
b[<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(ny/4)),<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(nx/4))]  = 100;
b[<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(3*ny/4)),<span style="color: #92a65e; font-weight: bold;">Int</span>(floor(3*nx/4))] = -100;


<span style="color: #8ac6f2; font-weight: bold;">for</span> it <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt

    pd = copy(p)

    p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = ((pd[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>] + pd[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])*dy^2 + 
        (pd[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+pd[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])*dx^2 -
    b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]*dx^2*dy^2)/(2*(dx^2+dy^2))

    p[1,:] = 0
    p[ny,:] = 0
    p[:,1] = 0
    p[:,nx] = 0
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">plot2D</span>(x, y, p)
    fig = plt.figure(figsize=(11,7), dpi=100)
    ss = plt.plot_surface(x,y,p, rstride=1, cstride=1, cmap=ColorMap(<span style="color: #95e454;">"coolwarm"</span>),
            linewidth=0)
    xlim(0,2)
    ylim(0,1)
<span style="color: #8ac6f2; font-weight: bold;">end</span>

plot2D(x, y, p)
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> Step 11: Cavity Flow with Navier-Stokes (last figure is not correct)</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1"><span class="section-number-3">14.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-14-1">
\begin{equation}
\label{eq:18}
\frac{\partial \vec{v}}{\partial t}+(\vec{v}\cdot\nabla)\vec{v}=-\frac{1}{\rho}\nabla p + \nu \nabla^2\vec{v}
\end{equation}
<p>
Here is the system of differential equations: two equations for the velocity components \(u,v\) and one equation for pressure:
</p>
\begin{equation}
\label{eq:19}
\frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu \left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2} \right) 
\end{equation}

\begin{equation}
\label{eq:20}
\frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right) 
\end{equation}

\begin{equation}
\label{eq:21}
\frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2} = -\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y} \right)

\end{equation}
</div>
</div>

<div id="outline-container-sec-14-2" class="outline-3">
<h3 id="sec-14-2"><span class="section-number-3">14.2</span> Discretized Equations</h3>
<div class="outline-text-3" id="text-14-2">
<p>
\begin{eqnarray}
&amp;&amp;\frac{u<sub>i,j</sub><sup>n+1</sup>-u<sub>i,j</sub><sup>n</sup>}{&Delta; t}+u<sub>i,j</sub><sup>n</sup>\frac{u<sub>i,j</sub><sup>n</sup>-u<sub>i-1,j</sub><sup>n</sup>}{&Delta; x}+v<sub>i,j</sub><sup>n</sup>\frac{u<sub>i,j</sub><sup>n</sup>-u<sub>i,j-1</sub><sup>n</sup>}{&Delta; y}\\\ 
&amp;&amp;=-\frac{1}{\rho}\frac{p<sub>i+1,j</sub><sup>n</sup>-p<sub>i-1,j</sub><sup>n</sup>}{2&Delta; x}+&nu;\left(\frac{u<sub>i+1,j</sub><sup>n</sup>-2u<sub>i,j</sub><sup>n</sup>+u<sub>i-1,j</sub><sup>n</sup>}{&Delta; x<sup>2</sup>}+\frac{u<sub>i,j+1</sub><sup>n</sup>-2u<sub>i,j</sub><sup>n</sup>+u<sub>i,j-1</sub><sup>n</sup>}{&Delta; y<sup>2</sup>}\right)\end{eqnarray}
</p>

<p>
\begin{eqnarray}
&amp;&amp;\frac{v<sub>i,j</sub><sup>n+1</sup>-v<sub>i,j</sub><sup>n</sup>}{&Delta; t}+u<sub>i,j</sub><sup>n</sup>\frac{v<sub>i,j</sub><sup>n</sup>-v<sub>i-1,j</sub><sup>n</sup>}{&Delta; x}+v<sub>i,j</sub><sup>n</sup>\frac{v<sub>i,j</sub><sup>n</sup>-v<sub>i,j-1</sub><sup>n</sup>}{&Delta; y}\\\
&amp;&amp;=-\frac{1}{\rho}\frac{p<sub>i,j+1</sub><sup>n</sup>-p<sub>i,j-1</sub><sup>n</sup>}{2&Delta; y}
<del>&nu;\left(\frac{v<sub>i+1,j</sub><sup>n</sup>-2v<sub>i,j</sub><sup>n</sup>+v<sub>i-1,j</sub><sup>n</sup>}{&Delta; x<sup>2</sup>}</del>\frac{v<sub>i,j+1</sub><sup>n</sup>-2v<sub>i,j</sub><sup>n</sup>+v<sub>i,j-1</sub><sup>n</sup>}{&Delta; y<sup>2</sup>}\right)\end{eqnarray}
</p>

\begin{equation}
\label{eq:22}
\frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2}+\frac{p_{i,j+1}^{n}-2*p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2} 
=\rho\left[\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)\right.
-\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}
- \ 2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x}
-\left.\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right]
\end{equation}
\begin{equation}
\label{eq:24}
u_{i,j}^{n+1} = u_{i,j}^{n} - u_{i,j}^{n}\frac{\Delta t}{\Delta x}(u_{i,j}^{n}-u_{i-1,j}^{n})
- v_{i,j}^{n}\frac{\Delta t}{\Delta y}(u_{i,j}^{n}-u_{i,j-1}^{n})$$
$$-\frac{\Delta t}{\rho 2\Delta x}(p_{i+1,j}^{n}-p_{i-1,j}^{n})
+\nu\left(\frac{\Delta t}{\Delta x^2}(u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n})\right.
+\left.\frac{\Delta t}{\Delta y^2}(u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n})\right)
\end{equation}


\begin{equation}
\label{eq:25}
v_{i,j}^{n+1} = v_{i,j}^{n}-u_{i,j}^{n}\frac{\Delta t}{\Delta x}(v_{i,j}^{n}-v_{i-1,j}^{n})
- v_{i,j}^{n}\frac{\Delta t}{\Delta y}(v_{i,j}^{n}-v_{i,j-1}^{n})
\end{equation}

\begin{equation}
\label{eq:26}
-\frac{\Delta t}{\rho 2\Delta y}(p_{i,j+1}^{n}-p_{i,j-1}^{n})
+\nu\left(\frac{\Delta t}{\Delta x^2}(v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n})\right.
+\left.\frac{\Delta t}{\Delta y^2}(v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n})\right)
\end{equation}
\begin{equation}
\label{eq:27}
p_{i,j}^{n}=\frac{(p_{i+1,j}^{n}+p_{i-1,j}^{n})\Delta y^2+(p_{i,j+1}^{n}+p_{i,j-1}^{n})\Delta x^2}{2(\Delta x^2+\Delta y^2)}-\frac{\rho\Delta x^2\Delta y^2}{2(\Delta x^2+\Delta y^2)} \times
\end{equation}

\begin{equation}
\label{eq:28}
\left[\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)-\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\right. 
\end{equation}

\begin{equation}
\label{eq:29}
-2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x}-\left.\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right]
\end{equation}

<p>
The initial condition is \(u, v, p = 0\) everywhere, and the boundary conditions are:
</p>

<p>
\(u=1\) at \(y=2\) (the "lid");
</p>

<p>
\(u, v=0\) on the other boundaries;
</p>

<p>
\(\frac{\partial p}{\partial y}=0\) at \(y=0\);
</p>

<p>
\(p=0\) at \(y=2\)
</p>

<p>
\(\frac{\partial p}{\partial x}=0\) at \(x=0,2\)
</p>
</div>
</div>

<div id="outline-container-sec-14-3" class="outline-3">
<h3 id="sec-14-3"><span class="section-number-3">14.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-14-3">
<p>
The  codes for this problem are
</p>

<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
nx = 41G;
ny = 41;
nt = 500;
nit=50;
c = 1;
dx = 2/(nx-1);
dy = 2/(ny-1);
x = linspace(0,2,nx);
y = linspace(0,2,ny);

rho = 1;
nu = .1;
dt = .001;

u = zeros((ny, nx));
v = zeros((ny, nx));
p = zeros((ny, nx)) ;
b = zeros((ny, nx));


<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">buildUpB</span>(b, rho, dt, u, v, dx, dy)

    b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]=rho*(1/dt*((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx)+(v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy))-
    ((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx))^2-
    2*((u[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-u[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy)*(v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx))-
    ((v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy))^2);

    <span style="color: #8ac6f2; font-weight: bold;">return</span> b;
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">presPoisson</span>(p, dx, dy, b)
    pn = zeros(size(p));
    pn = copy(p);

    <span style="color: #8ac6f2; font-weight: bold;">for</span> q <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nit
        pn = copy(p);
        p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = ((pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]+pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])*dy^2+(pn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+pn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])*dx^2)/
                        (2*(dx^2+dy^2)) -
        dx^2*dy^2/(2*(dx^2+dy^2))*b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1];

        p[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] =p[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]; <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 at x = 2</span>
        p[1,:] = p[2,:];  <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 at y = 0</span>
        p[:,1]=p[:,2];    <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dx = 0 at x = 0</span>
        p[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:]=0  ;      <span style="color: #99968b;">##</span><span style="color: #99968b;">p = 0 at y = 2</span>
    <span style="color: #8ac6f2; font-weight: bold;">end</span>        
    <span style="color: #8ac6f2; font-weight: bold;">return</span> p;
<span style="color: #8ac6f2; font-weight: bold;">end</span>        

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">cavityFlow</span>(nt, u, v, dt, dx, dy, p, rho, nu)
    un = zeros(size(u));
    vn = zeros(size(v));
    b = zeros((ny, nx))

    <span style="color: #8ac6f2; font-weight: bold;">for</span> n <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nt
        un = copy(u)
        vn = copy(v)

        b = buildUpB(b, rho, dt, u, v, dx, dy);
        p = presPoisson(p, dx, dy, b);

        u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-
            un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]*dt/dx*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
            vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]*dt/dy*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
            dt/(2*rho*dx)*(p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        nu*(dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]))

        v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-
        un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]*dt/dx*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
                        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]*dt/dy*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
                        dt/(2*rho*dy)*(p[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-p[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
                        nu*(dt/dx^2*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        (dt/dy^2*(vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])))

        u[1,:] = 0
        u[:,1] = 0
        u[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 0
        u[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 1    <span style="color: #99968b;">#</span><span style="color: #99968b;">set velocity on cavity lid equal to 1</span>
        v[1,:] = 0
        v[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:]=0
        v[:,1] = 0
        v[:,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = 0

    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> u, v, p
<span style="color: #8ac6f2; font-weight: bold;">end</span>


u = zeros((ny, nx));
v = zeros((ny, nx));
p = zeros((ny, nx));
b = zeros((ny, nx));
nt = 100;
u, v, p = cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu);
fig = figure(figsize=(11,7), dpi=100)
contourf(x,y,p,alpha=0.5)    <span style="color: #99968b;">###</span><span style="color: #99968b;">plnttong the pressure field as a contour</span>
colorbar()
contour(x,y,p)               <span style="color: #99968b;">###</span><span style="color: #99968b;">plotting the pressure field outlines</span>
xgrid = repmat(x', nx, 1 )
ygrid = repmat(y, 1, ny )
quiver(xgrid[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],ygrid[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],u[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],v[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]) <span style="color: #99968b;">##</span><span style="color: #99968b;">plotting velocity</span>
xlabel(<span style="color: #95e454;">'X'</span>)
ylabel(<span style="color: #95e454;">'Y'</span>);

u = zeros((ny, nx));
v = zeros((ny, nx));
p = zeros((ny, nx));
b = zeros((ny, nx));
nt = 700;
u, v, p = cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu);
fig = figure(figsize=(11,7), dpi=100);
contourf(x,y,p,alpha=0.5);
colorbar();
contour(x,y,p);
quiver(xgrid[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],ygrid[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],u[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>],v[1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1:2:<span style="color: #8ac6f2; font-weight: bold;">end</span>]); <span style="color: #99968b;">##</span><span style="color: #99968b;">plotting velocity</span>
xlabel(<span style="color: #95e454;">'X'</span>);
ylabel(<span style="color: #95e454;">'Y'</span>);
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> Step 12: Channel Flow with Navier-Stokes</h2>
<div class="outline-text-2" id="text-15">
</div><div id="outline-container-sec-15-1" class="outline-3">
<h3 id="sec-15-1"><span class="section-number-3">15.1</span> Mathematical Model</h3>
<div class="outline-text-3" id="text-15-1">
\begin{equation}
\label{eq:9}
 \frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y}=-\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu\left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2}\right)+F
\end{equation}

\begin{equation}
\label{eq:10}
\frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y}=-\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right)
\end{equation}


\begin{equation}
\label{eq:23}
\frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2}=-\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y}\right)
\end{equation}
</div>
</div>


<div id="outline-container-sec-15-2" class="outline-3">
<h3 id="sec-15-2"><span class="section-number-3">15.2</span> Discretized equations</h3>
<div class="outline-text-3" id="text-15-2">
<p>
The \(u\)-momentum equation:
</p>

\begin{eqnarray}
&&\frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i,j-1}^{n}}{\Delta y}\\\
&&=-\frac{1}{\rho}\frac{p_{i+1,j}^{n}-p_{i-1,j}^{n}}{2\Delta x}\\\
&&+\nu\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}+\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right)+F_{i,j}
\end{eqnarray}

<p>
The \(v\)-momentum equation:
</p>

\begin{eqnarray}
&&\frac{v_{i,j}^{n+1}-v_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i,j-1}^{n}}{\Delta y}\\\
&&=-\frac{1}{\rho}\frac{p_{i,j+1}^{n}-p_{i,j-1}^{n}}{2\Delta y}\\\
&&+\nu\left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}+\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right)
\end{eqnarray}

<p>
And the pressure equation:
</p>

\begin{eqnarray}
&&\frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2}+\frac{p_{i,j+1}^{n}-2*p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2}\\\
&&=\rho\left(\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)\right.\\\
&&-\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\\\
&&-2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x}\\\
&&-\left.\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)
\end{eqnarray}


<p>
For the \(u\)- and \(v\) momentum equations, we isolate the velocity at time step `n+1`:
</p>

<p>
$$u_{i,j}^{n+1} = u_{i,j}^{n} - u_{i,j}^{n}\frac{\Delta t}{\Delta x}(u_{i,j}^{n}-u_{i-1,j}^{n})-v_{i,j}^{n}\frac{\Delta t}{\Delta y}(u_{i,j}^{n}-u_{i,j-1}^{n})$$
$$-\frac{\Delta t}{\rho 2\Delta x}(p_{i+1,j}^{n}-p_{i-1,j}^{n})+\nu\left[\frac{\Delta t}{\Delta x^2}(u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n})\right.$$
$$+\left.\frac{\Delta t}{\Delta y^2}(u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n})\right] + F\Delta t$$
</p>

<p>
$$v_{i,j}^{n+1}=v_{i,j}^{n} - u_{i,j}^{n}\frac{\Delta t}{\Delta x}(v_{i,j}^{n}-v_{i-1,j}^{n})-v_{i,j}^{n}\frac{\Delta t}{\Delta y}(v_{i,j}^{n}-v_{i,j-1}^{n})$$
$$-\frac{\Delta t}{\rho 2\Delta y}(p_{i,j+1}^{n}-p_{i,j-1}^{n})+\nu\left[\frac{\Delta t}{\Delta x^2}(v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n})\right.$$
$$+\left.\frac{\Delta t}{\Delta y^2}(v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n})\right]$$
</p>

<p>
And for the pressure equation, we isolate the term \(p_{i,j}^n\) to iterate in pseudo-time:
</p>

<p>
$$p_{i,j}^{n} = \frac{(p_{i+1,j}^{n}+p_{i-1,j}^{n})\Delta y^2+(p_{i,j+1}^{n}+p_{i,j-1}^{n})\Delta x^2}{2(\Delta x^2+\Delta y^2)}-\frac{\rho\Delta x^2\Delta y^2}{2(\Delta x^2+\Delta y^2)}\times$$
$$\left[\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)- \frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x} \right.$$
$$- 2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x}-\left.\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right]$$
</p>

<p>
The initial condition is \(u, v, p=0\) everywhere, and at the boundary conditions are:
</p>

<p>
\(u, v, p\) are periodic on \(x=0,2\)
</p>

<p>
\(u, v =0\) at \(y =0,2\)
</p>

<p>
\(\frac{\partial p}{\partial y}=0\) at \(y =0,2\)
</p>

<p>
\(F=1\) everywhere.
</p>

<p>
Let's begin by importing our usual run of libraries:
</p>
</div>
</div>

<div id="outline-container-sec-15-3" class="outline-3">
<h3 id="sec-15-3"><span class="section-number-3">15.3</span> Julia Codes</h3>
<div class="outline-text-3" id="text-15-3">
<div class="org-src-container">

<pre class="src src-julia"><span style="color: #8ac6f2; font-weight: bold;">using</span> PyPlot
<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">buildUpB</span>(rho, dt, dx, dy, u, v)
    b = zeros(size(u))
    b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]=rho*(1/dt*((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx)+(v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy))-
                      ((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx)).^2-
                      2*((u[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-u[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy).*(v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])/(2*dx))-
                      ((v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dy)).^2)

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC Pressure @ x = 2</span>
    b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]=rho*(1/dt*((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dx)+(v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dy))-
        ((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dx)).^2-
    2*((u[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-u[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dy).*(v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])/(2*dx))-
    ((v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dy)).^2)

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC Pressure @ x = 0</span>
    b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]=rho*(1/dt*((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dx)+(v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])/(2*dy))-
    ((u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dx)).^2-
    2*((u[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-u[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])/(2*dy).*(v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])/(2*dx))-
                    ((v[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-v[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])/(2*dy)).^2)

    <span style="color: #8ac6f2; font-weight: bold;">return</span> b
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #8ac6f2; font-weight: bold;">function</span> <span style="color: #cae682;">presPoissPeriodic</span>(p, dx, dy)
    pn = zeros(size(p))

    <span style="color: #8ac6f2; font-weight: bold;">for</span> q <span style="color: #8ac6f2; font-weight: bold;">in</span> 1:nit
        pn = copy(p)
        p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = ((pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]+pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])*dy^2+(pn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+pn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])*dx^2)/
            (2*(dx^2+dy^2)) -
            dx^2*dy^2/(2*(dx^2+dy^2))*b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]

        <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC Pressure @ x = 2</span>
        p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = ((pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])*dy^2+(pn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]+pn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])*dx^2)/
            (2*(dx^2+dy^2)) -
        dx^2*dy^2/(2*(dx^2+dy^2))*b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]

        <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC Pressure @ x = 0</span>
        p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1] = ((pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]+pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])*dy^2+(pn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+pn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])*dx^2)/
            (2*(dx^2+dy^2)) -
            dx^2*dy^2/(2*(dx^2+dy^2))*b[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]

        <span style="color: #99968b;">####</span><span style="color: #99968b;">Wall boundary conditions, pressure</span>
        p[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] =p[<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,:]     <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 at y = 2</span>
        p[1,:] = p[2,:]      <span style="color: #99968b;">##</span><span style="color: #99968b;">dp/dy = 0 at y = 0</span>
    <span style="color: #8ac6f2; font-weight: bold;">end</span>
    <span style="color: #8ac6f2; font-weight: bold;">return</span> p
<span style="color: #8ac6f2; font-weight: bold;">end</span>

<span style="color: #99968b;">##</span><span style="color: #99968b;">variable declarations</span>
nx = 41;
ny = 41;
nt = 10;
nit=50 ;
c = 1;
dx = 2/(nx-1);
dy = 2/(ny-1);
x = linspace(0,2,nx);
y = linspace(0,2,ny);
xgrid = repmat(x', nx, 1);
ygrid = repmat(y, 1, ny);

<span style="color: #99968b;">##</span><span style="color: #99968b;">physical variables</span>
rho = 1;
nu = .1;
F = 1;
dt = .01;

<span style="color: #99968b;">#</span><span style="color: #99968b;">initial conditions</span>
u = zeros((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>
un = zeros((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>

v = zeros((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>
vn = zeros((ny,nx)) ;<span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>

p = ones((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>
pn = ones((ny,nx)); <span style="color: #99968b;">##</span><span style="color: #99968b;">create a XxY vector of 0's</span>

b = zeros((ny,nx));

udiff = 1;
stepcount = 0;

<span style="color: #8ac6f2; font-weight: bold;">while</span> udiff &gt; .001
    un = copy(u)
    vn = copy(v)

    b = buildUpB(rho, dt, dx, dy, u, v);
    p = presPoissPeriodic(p, dx, dy);

    u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-
        un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*dt/dx.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*dt/dy.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
        dt/(2*rho*dx)*(p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        nu*(dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]))+F*dt

    v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1] = vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-
        un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*dt/dx.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])-
        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1].*dt/dy.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
        dt/(2*rho*dy)*(p[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-p[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
        nu*(dt/dx^2*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2])+
        (dt/dy^2*(vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1]+vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])))

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC u @ x = 2     </span>
    u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-
    un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1, <span style="color: #8ac6f2; font-weight: bold;">end</span>].*dt/dx.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
    vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>].*dt/dy.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])-
        dt/(2*rho*dx)*(p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
        nu*(dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
        dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]+un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>]))+F*dt;

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC u @ x = 0</span>
    u[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1] = un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-
        un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1].*dt/dx.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])-
        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1].*dt/dy.*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])-
        dt/(2*rho*dx)*(p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-p[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])+
        nu*(dt/dx^2*(un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])+
        dt/dy^2*(un[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-2*un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+un[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1]))+F*dt;

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC v @ x = 2</span>
    v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>] = vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-
    un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1, <span style="color: #8ac6f2; font-weight: bold;">end</span>].*dt/dx.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])-
        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>].*dt/dy.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])-
        dt/(2*rho*dy)*(p[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-p[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])+
        nu*(dt/dx^2*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]+vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>-1])+
        (dt/dy^2*(vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,<span style="color: #8ac6f2; font-weight: bold;">end</span>]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>]+vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,<span style="color: #8ac6f2; font-weight: bold;">end</span>])));

    <span style="color: #99968b;">####</span><span style="color: #99968b;">Periodic BC v @ x = 0</span>
    v[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1] = vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-
        un[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1].*dt/dx.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])-
        vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1].*dt/dy.*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]-vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])-
        dt/(2*rho*dy)*(p[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-p[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])+
        nu*(dt/dx^2*(vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,2]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,<span style="color: #8ac6f2; font-weight: bold;">end</span>])+
        (dt/dy^2*(vn[3:<span style="color: #8ac6f2; font-weight: bold;">end</span>,1]-2*vn[2:<span style="color: #8ac6f2; font-weight: bold;">end</span>-1,1]+vn[1:<span style="color: #8ac6f2; font-weight: bold;">end</span>-2,1])))  ;   


    <span style="color: #99968b;">####</span><span style="color: #99968b;">Wall BC: u,v = 0 @ y = 0,2</span>
    u[1,:] = 0;
    u[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:] = 0;
    v[1,:] = 0;
    v[<span style="color: #8ac6f2; font-weight: bold;">end</span>,:]=0;

    udiff = (sum(u)-sum(un))/sum(u);
    stepcount += 1;
<span style="color: #8ac6f2; font-weight: bold;">end</span>

fig = figure(figsize = (11,7), dpi=100)
quiver(xgrid[1:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>, 1:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>], ygrid[2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>, 2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>], u[2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>, 2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>], v[2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>, 2:3:<span style="color: #8ac6f2; font-weight: bold;">end</span>]);

fig = figure(figsize = (11,7), dpi=100)
quiver(x, y, u, v);
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> <span class="done DONE">DONE</span> color map</h2>
<div class="outline-text-2" id="text-16">
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Zhengrong Cheng</p>
<p class="date">Created: 2016-09-26 Mon 12:24</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.0.50.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
